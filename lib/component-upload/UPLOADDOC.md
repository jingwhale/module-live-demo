# 教育产品上传前端设计文档

## 概况
教育产品一开始使用的是网易相册的上传方案。之后因为网易相册不再维护，开始全部转为使用nos上传方案。在nos上传方案中，前端上传文件时直接与nos接口交互，相关认证的逻辑放在教育产品的应用中。

## 上传相关的接口

### NOS接口
nos提供的前端上传接口有两种：表单上传和直传

相关文档链接：[nos表单上传接口](), [nos直传上传接口]()

#### 表单上传接口的使用场景：
1. 小文件上传，比如图片、字幕、excel文件、doc文件等，表单上传接口限制了文件不能超过100Mb
2. 浏览器不支持XMLHttpRequest2或者不支持本地文件切分


#### 直传上传接口的使用场景：
1. 大文件上传，一般文件大小大于100Mb，比如视频、pdf、大附件等
2. 浏览器支持XMLHttpRequest2并且支持本地文件切分，通过直传接口可以实现断点续传。

只在文件上传过程中前端会直接调用nos上传接口，其他逻辑：如凭证获取、nos信息获取、断点续传进度获取和保存等是调用应用接口实现的。

#### 如何获得文件上传后的线上地址

### 应用接口
教育产品应用中的提供了上传相关的接口
#### 1. 获取应用凭证接口
每个web应用都要实现一个获取上传凭证的接口，该接口参数需要文件信息，对于无法获取文件信息的低版本浏览器，后端需要采用兼容的方式生成凭证。
建议每个web应用的前端工程中配置一个全局的上传凭证获取接口。
例如企业云中的配置：

````
	 // 业务全局配置
    window.defaultConfig = window.eduProduct = {
    	"avatar":'/res/images/common/default/userface.png',
    	"coursecover": '/res/images/common/default/defaultcourse.png',
      	"initUploadUrl": "/enterprise/UploaderCenterManager/getEduUploaderToken.do",
   		"logoutUrl": "/passport/member/logout.htm",
    	"gaAccount": "UA-35176345-6",
    	"gaProduct": "qyy"
    }
    
````

initUploadUrl字段就是上传凭证获取接口，当然这样定义后目前组件并不能自动获取，请查看组件详细使用文档，确保组件能正确配置。

#### 2. 获取nos上传信息
#### 3. 断点续传进度获取接口
#### 4. 断点续传进度保存接口
#### 5. 文件完整性校验接口

### 旧的上传接口
目前还遗留一个旧的上传接口

### 上传接口跨域的解决方案

## 上传流程和时序图
### 上传流程
### 时序图

## 前端上传组件
### 组件概况
### 上传基础工具类
### 简单文件上传组件
### 有进度的文件上传组件
### 多文件同时上传组件
### 图片上传组件
### 图片可自定义截取的上传组件
