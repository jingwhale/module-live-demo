<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>教育产品组件开发文档 Source: draggable.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">教育产品组件开发文档</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="module-pool_component-drag-drop_src_dragDrop.html">pool/component-drag-drop/src/dragDrop</a></li><li><a href="module-pool_component-drag-drop_src_draggable.html">pool/component-drag-drop/src/draggable</a></li><li><a href="module-pool_component-drag-drop_src_droppable.html">pool/component-drag-drop/src/droppable</a></li><li><a href="module-pool_component-drag-drop_src_util.html">pool/component-drag-drop/src/util</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="module-pool_component-drag-drop_src_draggable.html#~event:drag%25E6%25AD%25A3%25E5%259C%25A8%25E6%258B%2596%25E6%258B%25BD%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:drag     正在拖拽时触发</a></li><li><a href="module-pool_component-drag-drop_src_draggable.html#~event:dragend%25E6%258B%2596%25E6%258B%25BD%25E7%25BB%2593%25E6%259D%259F%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:dragend           拖拽结束时触发</a></li><li><a href="module-pool_component-drag-drop_src_droppable.html#~event:dragenter%25E6%258B%2596%25E6%258B%25BD%25E8%25BF%259B%25E5%2585%25A5%25E8%25AF%25A5%25E5%2585%2583%25E7%25B4%25A0%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:dragenter          拖拽进入该元素时触发</a></li><li><a href="module-pool_component-drag-drop_src_droppable.html#~event:dragleave%25E6%258B%2596%25E6%258B%25BD%25E7%25A6%25BB%25E5%25BC%2580%25E8%25AF%25A5%25E5%2585%2583%25E7%25B4%25A0%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:dragleave          拖拽离开该元素时触发</a></li><li><a href="module-pool_component-drag-drop_src_droppable.html#~event:dragover%25E6%258B%2596%25E6%258B%25BD%25E5%259C%25A8%25E8%25AF%25A5%25E5%2585%2583%25E7%25B4%25A0%25E4%25B8%258A%25E6%2596%25B9%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:dragover           拖拽在该元素上方时触发</a></li><li><a href="module-pool_component-drag-drop_src_draggable.html#~event:dragstart%25E6%258B%2596%25E6%258B%25BD%25E5%25BC%2580%25E5%25A7%258B%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:dragstart 拖拽开始时触发</a></li><li><a href="module-pool_component-drag-drop_src_droppable.html#~event:drop%25E6%258B%2596%25E6%258B%25BD%25E6%2594%25BE%25E7%25BD%25AE%25E6%2597%25B6%25E8%25A7%25A6%25E5%258F%2591">event:drop            拖拽放置时触发</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: draggable.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 *  Draggable 拖拽类文件
 *
 *  @version  1.0
 *  @author   cqh &lt;cqh@corp.netease.com>
 *  @module   pool/component-drag-drop/src/draggable
 */
NEJ.define([
    'pool/component-base/src/base',
    './util.js',
    './dragDrop.js'
],function(
    Base,
    _,
    dragDrop
){
    /**
     * drag基类
     *
     * @example
     * &lt;ux-draggable> your html or component&lt;/ux-draggable>
     *
     * @class
     * @extend module:pool/component-base/src/base.Base
     * @param {Object}                   options.data                            初始化属性
     * @param {Object}                   [options.data.data=null]                拖拽传递的数据
     * @param {String|Element|Function}  [options.data.proxy="clone"]            拖拽代理，即拖拽时显示的元素。支持clone/self/选择器,直接传入代理元素，函数(返回代理元素)，&lt;draggable.proxy>包裹代理元素
     * @param {String}                   [options.data.direction="all"]          拖拽代理可以移动的方向，`all`为任意方向，`horizontal`为水平方向，`vertical`为垂直方向
     * @param {Boolean}                  [options.data.disabled=false]           是否禁用
     * @param {String}                   [options.data.class='z-draggable']      可拖拽时（即disabled=false）给元素附加此class
     * @param {String}                   [options.data.dragClass='z-drag']       拖拽该元素时给元素附加此class
     * @param {Boolean}                  [options.data.notPreventDefault=false]  mousedown的时候是否preventDefault,默认阻止
     *
     */

    // 解决点击一下，两个事件mouseDown
    var _mouseDownFlag =  false;

    var _useragent = window.navigator.userAgent;
    // ie8有offsetLeft兼容性问题，直接不显示代理元素
    var isIe8 = new RegExp("MSIE 8.0",'i').test(_useragent);

    var Draggable = Base.extend({
        name: 'ux-draggable',
        template: '{#inc this.$body}',

        /**
         * 初始化-config
         *
         * @protected
         * @method
         * @return {Void}
         */
        config: function() {
            _.extend(this.data, {
                data: null,
                proxy: 'clone',
                direction: 'all',
                'class': 'z-draggable',
                dragClass: 'z-drag'
            });
            this.supr();

            this._onMouseDown = this._onMouseDown.bind(this);
            this._onBodyMouseMove = this._onBodyMouseMove.bind(this);
            this._onBodyMouseUp = this._onBodyMouseUp.bind(this);
            this.cancel = this.cancel.bind(this);
        },

        /**
         * 初始化-init
         *
         * @protected
         * @method
         * @return {Void}
         */
        init: function() {

            var inner = _.dom.element(this);
            _.dom.on(inner, 'mousedown', this._onMouseDown);
            this.supr();

            this.$watch('disabled', function(newValue) {
                if(newValue){
                    _.dom.delClass(inner, this.data['class']);

                }else{
                    _.dom.addClass(inner, this.data['class']);
                }
            });
        },

        /**
         * @method  获取拖拽代理
         * @private
         * @return {Element} 拖拽代理元素
         */
        _getProxy: function() {
            var dimension, proxy;
            if(typeof this.data.proxy === 'function'){
                return this.data.proxy();
            }
            else if(this.data.proxy.nodeType &amp;&amp; this.data.proxy instanceof Element) {
                // 直接传入页面中有的元素进行代理
                proxy = this.data.proxy.cloneNode(true);
                dimension = _.dom.getDimension(_.dom.element(this));
                this._initProxy(proxy, dimension);
                this.data.proxy.parentElement.appendChild(proxy);
                return proxy;
            }
            else if(this.data.proxy instanceof Draggable.Proxy) {
                proxy = _.dom.element(this.data.proxy);
                dimension = _.dom.getDimension(_.dom.element(this));
                this._initProxy(proxy, dimension);
                document.body.appendChild(proxy);
                return proxy;

            } else if(this.data.proxy === 'clone') {
                var self = _.dom.element(this);
                dimension = _.dom.getDimension(self);
                proxy = self.cloneNode(true);
                this._initProxy(proxy, dimension);
                self.parentElement.appendChild(proxy);
                return proxy;

            } else if(this.data.proxy === 'self') {
                proxy = _.dom.element(this);
                dimension = _.dom.getDimension(proxy);
                this._initProxy(proxy, dimension);
                return proxy;
            }
            else if(typeof this.data.proxy === 'string'){ // 选择器
                var oldProxy = _.dom.find(this.data.proxy);
                if(!oldProxy){return}
                proxy =  oldProxy.cloneNode(true);
                dimension = _.dom.getDimension(_.dom.element(this));
                this._initProxy(proxy, dimension);
                oldProxy.parentElement.appendChild(proxy);
                return proxy;
            }
        },

        /**
         * @method 初始化拖拽代理
         * @private
         * @return {void}
         */
        _initProxy: function(proxy, dimension) {
            proxy.style.left = dimension.left + (this.data.leftFix||0) + 'px'; //可以传入leftFix topFix进行修正
            proxy.style.top = dimension.top + (this.data.topFix||0) + 'px';
            proxy.style.zIndex = '2000';
            proxy.style.position = 'fixed';
            proxy.style.display = '';
            if(isIe8){
                proxy.style.display = 'none';

            }
        },

        /**
         * @method mouseDown函数
         * @private
         * @return {void}
         */
        _onMouseDown: function($event) {
            if(_mouseDownFlag||this.data.disabled){
                return;
            }
            _mouseDownFlag = true;

            if(!this.data.notPreventDefault){
                $event.preventDefault();
            }
            //避免选中元素
            _.dom.addClass(document.body, 'f-unselectable');
            _.dom.on(document, 'mousemove', this._onBodyMouseMove);
            _.dom.on(document, 'mouseup', this._onBodyMouseUp);
        },

        /**
         * @method mouseMove函数
         * @private
         * @return {void}
         */
        _onBodyMouseMove: function($event) {
            _mouseDownFlag = false;
            var e = $event.event;
            $event.preventDefault();

            if(dragDrop.dragging === false) {
                _.extend(dragDrop, {
                    dragging: true,
                    data: this.data.data,
                    proxy: this._getProxy(),
                    screenX: e.screenX,
                    screenY: e.screenY,
                    clientX: e.clientX,
                    clientY: e.clientY,
                    pageX: e.pageX,
                    pageY: e.pageY,
                    movementX: 0,
                    movementY: 0,
                    droppable: undefined
                }, true);

                this._dragStart();
            } else {
                _.extend(dragDrop, {
                    screenX: e.screenX,
                    screenY: e.screenY,
                    clientX: e.clientX,
                    clientY: e.clientY,
                    pageX: e.pageX,
                    pageY: e.pageY,
                    movementX: e.screenX - dragDrop.screenX,
                    movementY: e.screenY - dragDrop.screenY
                }, true);

                if(dragDrop.proxy) {
                    if(this.data.direction === 'all' || this.data.direction === 'horizontal')
                        dragDrop.proxy.style.left = dragDrop.proxy.offsetLeft + dragDrop.movementX + 'px';

                    if(this.data.direction === 'all' || this.data.direction === 'vertical')
                        dragDrop.proxy.style.top = dragDrop.proxy.offsetTop + dragDrop.movementY + 'px';
                }

                this._drag();
                if(!dragDrop.dragging)
                    return;

                // Drop
                var pointElement = null;
                if(dragDrop.proxy) {
                    dragDrop.proxy.style.display = 'none';
                    pointElement = document.elementFromPoint(e.clientX, e.clientY);
                    if(!isIe8){
                        dragDrop.proxy.style.display = '';
                    }

                } else{
                    pointElement = document.elementFromPoint(e.clientX, e.clientY);

                }

                var element = pointElement;
                var pointDroppable = null;
                while(element) {
                    pointDroppable = dragDrop.droppables.find(function(droppable){
                        var target = _.dom.element(droppable);
                        if(element === target){
                            return true;
                        }
                    });
                    if(pointDroppable){
                        break;
                    }
                    element = element.parentElement;
                }


                if(dragDrop.droppable !== pointDroppable) {
                    dragDrop.droppable &amp;&amp; dragDrop.droppable._dragLeave(this);
                    if(!dragDrop.dragging)
                        return;
                    pointDroppable &amp;&amp; pointDroppable._dragEnter(this);
                    if(!dragDrop.dragging)
                        return;
                    dragDrop.droppable = pointDroppable;
                } else
                    pointDroppable &amp;&amp; pointDroppable._dragOver(this);
            }

        },

        /**
         * @method mouseUp函数
         * @private
         * @return {void}
         */
        _onBodyMouseUp: function($event) {
            _mouseDownFlag = false;
            var e = $event.event;
            $event.preventDefault();
            _.dom.delClass(document.body, 'f-unselectable');
            this._dragEnd();
            dragDrop.droppable &amp;&amp; dragDrop.droppable._drop(this);
            this.cancel();
        },

        /**
         * 组件change的响应方法
         *
         * @private
         * @method
         * @return {Void}
         */
        cancel: function() {

            _.extend(dragDrop, {
                dragging: false,
                data: null,
                proxy: null,
                screenX: 0,
                screenY: 0,
                clientX: 0,
                clientY: 0,
                pageX: 0,
                pageY: 0,
                movementX: 0,
                movementY: 0,
                droppable: undefined
            }, true);

            _.dom.off(document, 'mousemove', this._onBodyMouseMove);
            _.dom.off(document, 'mouseup', this._onBodyMouseUp);
        },
        /**
         * @private
         */
        _dragStart: function(e) {
            if(dragDrop.proxy)
                _.dom.addClass(dragDrop.proxy, this.data.dragClass);

            /**
             * @event          dragstart 拖拽开始时触发
             * @param {Object} sender    事件发送对象，为当前draggable
             * @param {Object} origin    拖拽源，为当前draggable
             * @param {Object} source    拖拽起始元素
             * @param {Object} proxy     拖拽代理元素
             * @param {Object} data      拖拽时需要传递的数据
             * @param {Number} screenX   鼠标指针相对于屏幕的水平位置
             * @param {Number} screenY   鼠标指针相对于屏幕的垂直位置
             * @param {Number} clientX   鼠标指针相对于浏览器的水平位置
             * @param {Number} clientY   鼠标指针相对于浏览器的垂直位置
             * @param {Number} pageX     鼠标指针相对于页面的水平位置
             * @param {Number} pageY     鼠标指针相对于页面的垂直位置
             * @param {Number} movementX 鼠标指针水平位置相对于上次操作的偏移量
             * @param {Number} movementY 鼠标指针垂直位置相对于上次操作的偏移量
             * @param {Function} cancel  取消拖拽操作
             */
            this.$emit('dragstart', _.extend({
                sender: this,
                origin: this,
                source: _.dom.element(this),
                proxy: dragDrop.proxy,
                cancel: this.cancel
            }, dragDrop));
        },

        /**
         * @method 正在拖拽函数
         * @private
         * @return {void}
         */
        _drag: function() {
            /**
             * @event drag     正在拖拽时触发
             * @param {Object} sender       事件发送对象，为当前draggable
             * @param {Object} origin       拖拽源，为当前draggable
             * @param {Object} source       拖拽起始元素
             * @param {Object} proxy        拖拽代理元素
             * @param {Object} data         拖拽时需要传递的数据
             * @param {Number} screenX      鼠标指针相对于屏幕的水平位置
             * @param {Number} screenY      鼠标指针相对于屏幕的垂直位置
             * @param {Number} clientX      鼠标指针相对于浏览器的水平位置
             * @param {Number} clientY      鼠标指针相对于浏览器的垂直位置
             * @param {Number} pageX        鼠标指针相对于页面的水平位置
             * @param {Number} pageY        鼠标指针相对于页面的垂直位置
             * @param {Number} movementX    鼠标指针水平位置相对于上次操作的偏移量
             * @param {Number} movementY    鼠标指针垂直位置相对于上次操作的偏移量
             * @param {Function} cancel     取消拖拽操作
             */
            this.$emit('drag', _.extend({
                sender: this,
                origin: this,
                source: _.dom.element(this),
                proxy: dragDrop.proxy,
                cancel: this.cancel
            }, dragDrop));
        },
        /**
         * @method 拖拽结束函数
         * @private
         * @return {void}
         */
        _dragEnd: function() {
            /**
             * @event dragend           拖拽结束时触发
             * @param {Object} sender   事件发送对象，为当前draggable
             * @param {Object} origin   拖拽源，为当前draggable
             * @param {Object} source   拖拽起始元素
             * @param {Object} proxy    拖拽代理元素
             */
            this.$emit('dragend', {
                sender: this,
                origin: this,
                source: _.dom.element(this),
                proxy: dragDrop.proxy
            });

            if(dragDrop.proxy) {
                if(this.data.proxy != 'self') //销毁
                    dragDrop.proxy.parentElement.removeChild(dragDrop.proxy);

                _.dom.delClass(dragDrop.proxy, this.data.dragClass);
            }
        }
    });

    Draggable.Proxy = Base.extend({
        name: 'draggable.proxy',
        template: '{#inc this.$body}',
        init: function() {
            if(this.$outer instanceof Draggable) {
                _.dom.element(this).style.display = 'none';
                this.$outer.data.proxy = this;
            }
        }
    });
    return Draggable;
});
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	网易教育产品部 前端组
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a>
	
		on Sat Sep 17th 2016
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
